<app-header></app-header>

<!-- HERO SECTION -->
<div class="hero_area">
    <div class="hero_content">
        <div class="container">
            <div class="hero_text">
                <h1>Gestão de <span class="highlight">Turmas</span></h1>
                <p>Visualize e gerencie as turmas cadastradas na instituição.</p>
            </div>
        </div>
    </div>
</div>

<!-- SECTION PRINCIPAL -->
<section class="main-content">
    <div class="container">

        <!-- CARD DA LISTAGEM -->
        <div class="card-box">

            <!-- Cabeçalho da Lista com Busca Avançada -->
            <div class="list-header">
                <div class="title-wrapper">
                    <mat-icon class="title-icon">view_list</mat-icon>
                    <h3>Turmas Cadastradas</h3>
                </div>

                <div class="header-actions">
                    <span class="badge-count">{{ totalTurmas() }} registros</span>
                </div>
            </div>

            <!-- BARRA DE BUSCA AVANÇADA -->
            <div class="advanced-search-bar">
                <div class="search-row">
                    <!-- Select de Tipo de Filtro -->
                    <mat-form-field appearance="outline" class="filter-type-field">
                        <mat-label>Buscar por</mat-label>
                        <mat-select [formControl]="filterTypeControl">
                            <mat-option *ngFor="let option of filterOptions" [value]="option.value">
                                {{ option.label }}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>

                    <!-- Input de Busca -->
                    <mat-form-field appearance="outline" class="search-input-field">
                        <mat-label>Termo de busca</mat-label>
                        <input matInput [formControl]="searchControl" [placeholder]="getPlaceholder()">
                        <mat-icon matPrefix>search</mat-icon>
                        <button mat-icon-button matSuffix *ngIf="searchControl.value"
                            (click)="searchControl.setValue('')" matTooltip="Limpar busca">
                            <mat-icon>close</mat-icon>
                        </button>
                    </mat-form-field>

                    <!-- Botão Limpar Filtros -->
                    <button mat-raised-button color="accent" class="clear-filters-btn" (click)="limparFiltros()"
                        [disabled]="!searchControl.value" matTooltip="Limpar todos os filtros">
                        <mat-icon>filter_alt_off</mat-icon>
                        Limpar
                    </button>
                </div>
            </div>

            <!-- Loading State -->
            <div *ngIf="isLoading()" class="loading-container">
                <mat-spinner diameter="40"></mat-spinner>
                <p>Carregando turmas...</p>
            </div>

            <!-- Tabela -->
            <div class="table-responsive" *ngIf="!isLoading()">
                <table class="modern-table">
                    <thead>
                        <tr>
                            <th style="width: 25%;">Turma / Ano</th>
                            <th style="width: 20%;">Série</th>
                            <th style="width: 15%;">Turno</th>
                            <th style="width: 25%;">Detalhes (Disc. / Prof.)</th>
                            @if(auth.isAdmin()){
                                <th style="width: 15%;" class="text-end">Ações</th>
                                <th style="width: 15%;" class="text-end">+ Aluno</th>
                            }

                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let turma of turmas()">
                            <!-- Turma e Ano -->
                            <td>
                                <div class="cell-content">
                                    <span class="primary-text">{{ turma.nome }}</span>
                                    <span class="secondary-text"><mat-icon class="tiny-icon">calendar_today</mat-icon>
                                        {{ turma.ano_letivo }}</span>
                                </div>
                            </td>

                            <!-- Série -->
                            <td>
                                <span class="text-regular">{{ turma.serie }}</span>
                            </td>

                            <!-- Turno (Badge) -->
                            <td>
                                <span class="badge-turno {{ turma.turno.toLowerCase() }}">
                                    {{ getTurnoLabel(turma.turno) }}
                                </span>
                            </td>

                            <!-- Disciplina e Professor -->
                            <td>
                                <div class="cell-content">
                                    <span class="info-row">
                                        <mat-icon class="tiny-icon" matTooltip="Disciplina">book</mat-icon>
                                        {{ turma.nome_disciplina || '---' }}
                                    </span>
                                    <span class="info-row text-muted">
                                        <mat-icon class="tiny-icon" matTooltip="Professor">person</mat-icon>
                                        {{ turma.nome_professor || '---' }}
                                    </span>
                                </div>
                            </td>

                            @if(auth.isAdmin()){
                                <!-- Ações -->
                                 <td class="text-end">
                                    <div class="actions-wrapper">
                                        <button mat-icon-button class="action-btn edit" (click)="editarTurma(turma)"
                                            matTooltip="Editar Turma">
                                            <mat-icon>edit</mat-icon>
                                        </button>
                                        <button mat-icon-button class="action-btn delete" (click)="removerTurma(turma)"
                                            matTooltip="Excluir Turma">
                                            <mat-icon>delete_outline</mat-icon>
                                        </button>
                                    </div>
                                </td>

                                <td class="text-end">
                                    <button mat-icon-button class="action-btn add-student"
                                        (click)="openCadAlunoTurmaDialog(turma)" matTooltip="Adicionar Aluno à Turma">
                                        <mat-icon>person_add</mat-icon>
                                    </button>
                                </td>
                            }
                        </tr>

                        <!-- Empty State -->
                        <tr *ngIf="turmas().length === 0">
                            <td colspan="5" class="empty-state">
                                <div class="empty-content">
                                    <mat-icon>school</mat-icon>
                                    <h4>Nenhuma turma encontrada</h4>
                                    <p>Não há registros cadastrados no momento.</p>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Paginação -->
            <mat-paginator [length]="totalTurmas()" [pageSize]="pageSize()" [pageIndex]="pageIndex()"
                [pageSizeOptions]="pageSizeOptions" (page)="onPageChange($event)" showFirstLastButtons
                class="custom-paginator">
            </mat-paginator>
        </div>
    </div>
</section>

<app-footer></app-footer>