<app-header></app-header>

<div class="hero_area">
    <div class="container">
        <div class="hero_content">
            <h1>Gerenciar <span>Usuários</span></h1>
            <p>Controle de acesso, troca de senhas e status de contas.</p>
        </div>
    </div>
</div>

<div class="main-container container">

    <div class="card-table">
        <div class="table-header">
            <h3>Lista de Usuários Cadastrados</h3>
            <button mat-icon-button color="primary" (click)="carregarUsuarios()" matTooltip="Atualizar Lista">
                <mat-icon>refresh</mat-icon>
            </button>
        </div>

        <div class="loading-shade" *ngIf="isLoading()">
            <mat-spinner diameter="40"></mat-spinner>
        </div>

        <div class="table-responsive">
            <table mat-table [dataSource]="usuarios()" class="user-table">

                <!-- ID Column -->
                <ng-container matColumnDef="id">
                    <th mat-header-cell *matHeaderCellDef> ID </th>
                    <td mat-cell *matCellDef="let row"> #{{row.id}} </td>
                </ng-container>

                <!-- CPF Column -->
                <ng-container matColumnDef="cpf">
                    <th mat-header-cell *matHeaderCellDef> CPF </th>
                    <td mat-cell *matCellDef="let row" class="monospace"> {{formatCpf(row.cpf)}} </td>
                </ng-container>

                <!-- Email Column -->
                <ng-container matColumnDef="email">
                    <th mat-header-cell *matHeaderCellDef> E-mail </th>
                    <td mat-cell *matCellDef="let row"> {{row.email}} </td>
                </ng-container>

                <!-- Perfil Column -->
                <ng-container matColumnDef="perfil">
                    <th mat-header-cell *matHeaderCellDef> Perfil </th>
                    <td mat-cell *matCellDef="let row">
                        <span class="badge-perfil" [ngClass]="row.perfil">
                            {{row.perfil}}
                        </span>
                    </td>
                </ng-container>

                <!-- Status Column -->
                <ng-container matColumnDef="status">
                    <th mat-header-cell *matHeaderCellDef> Status </th>
                    <td mat-cell *matCellDef="let row">
                        <span class="status-indicator" [class.active]="row.ativo" [class.inactive]="!row.ativo">
                            {{ row.ativo ? 'ATIVO' : 'INATIVO' }}
                        </span>
                    </td>
                </ng-container>

                <!-- Ações Column -->
                <ng-container matColumnDef="acoes">
                    <th mat-header-cell *matHeaderCellDef class="text-end"> Ações </th>
                    <td mat-cell *matCellDef="let row" class="text-end">

                        <button mat-icon-button [matMenuTriggerFor]="menu">
                            <mat-icon>more_vert</mat-icon>
                        </button>

                        <mat-menu #menu="matMenu">
                            <button mat-menu-item (click)="abrirTrocaSenha(row)">
                                <mat-icon>lock_reset</mat-icon>
                                <span>Trocar Senha</span>
                            </button>
                            <button mat-menu-item (click)="desativarUsuario(row)" [disabled]="!row.ativo"
                                class="warn-item">
                                <mat-icon color="warn">block</mat-icon>
                                <span class="text-danger">Desativar Conta</span>
                            </button>
                        </mat-menu>
                    </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

                <!-- Row shown when there is no matching data. -->
                <tr class="mat-row" *matNoDataRow>
                    <td class="mat-cell empty-cell" colspan="6">
                        Nenhum usuário encontrado.
                    </td>
                </tr>
            </table>
        </div>

        <mat-paginator [length]="totalUsers()" [pageSize]="pageSize()" [pageSizeOptions]="pageSizeOptions"
            (page)="onPageChange($event)" showFirstLastButtons>
        </mat-paginator>
    </div>

</div>

<app-footer></app-footer>