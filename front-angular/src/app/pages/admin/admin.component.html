<app-header></app-header>

<body>
    <div class="app">
        <aside>
            <div class="brand">Escola Modelo</div>
            <nav>
                <a href="#">Dashboard</a>
                <a routerLink="/cadastro-login">Cadastro Login</a>
                <a routerLink="/cadastro-aluno">Cadastro Aluno</a>
                <a href="#">Alunos</a>
                <a href="#">Professores</a>
                <a href="#">Turmas</a>
                <a href="#">Calend√°rio</a>
                <a href="#">Configura√ß√µes</a>
            </nav>
            <div style="margin-top:auto;font-size:13px;opacity:0.95">
                Vers√£o gr√°tis ‚Ä¢ <br> Desenvolvido por voc√™
            </div>
        </aside>

        <main>
            <header>
                <div>
                    <h2 style="margin:0 0 6px 0">Painel</h2>
                    <div style="color:var(--muted);font-size:14px">Vis√£o geral dos √∫ltimos registros</div>
                </div>
                <div style="display:flex;gap:12px;align-items:center">
                    <div class="search-container">
                        <input type="text" [(ngModel)]="searchQuery" (input)="onSearch()"
                            placeholder="üîç Buscar aluno por nome, matr√≠cula ou CPF..." class="search-input">
                    </div>
                    <div style="background:var(--card);padding:8px 12px;border-radius:10px">Ol√°, Admin</div>
                </div>
            </header>

            <section class="card stat-totals">
                <h3 style="margin-top:0">Total de Alunos: {{ totalAlunos() }}</h3>
            </section>

            <section class="card">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px">
                    <h3 style="margin:0">Lista de Alunos</h3>
                    <button class="btn-primary" routerLink="/cadastro-aluno">+ Novo Aluno</button>
                </div>

                <!-- Mensagens de sucesso/erro -->
                <div *ngIf="successMessage()" class="alert alert-success">
                    {{ successMessage() }}
                </div>
                <div *ngIf="errorMessage()" class="alert alert-danger">
                    {{ errorMessage() }}
                </div>

                <!-- Loading -->
                <div *ngIf="isLoading()" class="loading-container">
                    <div class="spinner"></div>
                    <p>Carregando alunos...</p>
                </div>

                <!-- Tabela de alunos -->
                <div *ngIf="!isLoading()">
                    <table *ngIf="filteredAlunos.length > 0">
                        <thead>
                            <tr>
                                <th>Matr√≠cula</th>
                                <th>Nome</th>
                                <th>CPF</th>
                                <th>Data Nasc.</th>
                                <th>Idade</th>
                                <th>Telefone</th>
                                <th>Endere√ßo</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let aluno of filteredAlunos">
                                <td><strong>{{ aluno.matricula }}</strong></td>
                                <td>{{ aluno.nome }}</td>
                                <td>{{ formatCpf(aluno.cpf) }}</td>
                                <td>{{ aluno.data_nascimento | date: 'dd/MM/yyyy' }}</td>
                                <td>{{ calcularIdade(aluno.data_nascimento) }} anos</td>
                                <td>{{ formatTelefone(aluno.telefone) }}</td>
                                <td>{{ aluno.endereco }}</td>
                                <td class="actions">
                                    <button class="btn-danger-small" (click)="deleteAluno(aluno)" title="Excluir aluno">
                                        üóëÔ∏è Excluir
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <!-- Mensagem quando n√£o h√° resultados -->
                    <div *ngIf="filteredAlunos.length === 0" class="no-results">
                        <p>Nenhum aluno encontrado.</p>
                        <button class="btn-primary" routerLink="/cadastro-aluno">Cadastrar Primeiro Aluno</button>
                    </div>

                    <!-- Pagina√ß√£o -->
                    <div *ngIf="filteredAlunos.length > 0 && totalPages() > 1" class="pagination">
                        <button class="pagination-btn" (click)="previousPage()" [disabled]="currentPage() === 1">
                            ‚Üê Anterior
                        </button>

                        <div class="pagination-pages">
                            <button *ngFor="let page of pageNumbers" class="pagination-page"
                                [class.active]="page === currentPage()" (click)="goToPage(page)">
                                {{ page }}
                            </button>
                        </div>

                        <button class="pagination-btn" (click)="nextPage()" [disabled]="currentPage() === totalPages()">
                            Pr√≥xima ‚Üí
                        </button>
                    </div>

                    <div class="pagination-info" *ngIf="filteredAlunos.length > 0">
                        Mostrando {{ (currentPage() - 1) * itemsPerPage + 1 }} -
                        {{ Math.min(currentPage() * itemsPerPage, totalAlunos()) }}
                        de {{ totalAlunos() }} alunos
                    </div>
                </div>
            </section>

        </main>
    </div>
</body>