<app-header></app-header>

<body>
    <div class="app">
        <aside>
            <div class="brand">MENU</div>
            <nav>
                <a href="#">Dashboard</a>
                <a routerLink="/cadastro-login">Cadastro Login</a>
                <a routerLink="/cadastro-aluno">Cadastro Aluno</a>
                <a routerLink="/cadastro-professor">Cadastro Professor</a>
                <a routerLink="/cadastro-disciplina">Cadastro Disciplina</a>
                <a routerLink="/cadastro-turma">Cadastro Turma</a>
                <a href="#">Alunos</a>
                <a href="#">Professores</a>
                <a href="#">Turmas</a>
                <a href="#">Calend√°rio</a>
                <a href="#">Configura√ß√µes</a>
            </nav>
            <div style="margin-top:auto;font-size:13px;opacity:0.95">
                Vers√£o v.2
            </div>
        </aside>

        <main>
            <header>
                <div>
                    <h2 style="margin:0 0 6px 0">Painel</h2>
                    <div style="color:var(--muted);font-size:14px">Vis√£o geral dos √∫ltimos registros</div>
                </div>
            </header>

            <section class="stats-grid">
                <div class="stat-card alunos-card">
                    <div class="stat-icon">
                        <mat-icon>school</mat-icon>
                    </div>
                    <div class="stat-content">
                        <div class="stat-label">Total de Alunos</div>
                        <div class="stat-number">{{ totalAlunos() }}</div>
                    </div>
                </div>

                <div class="stat-card professores-card">
                    <div class="stat-icon">
                        <mat-icon>person</mat-icon>
                    </div>
                    <div class="stat-content">
                        <div class="stat-label">Total de Professores</div>
                        <div class="stat-number">{{ totalProfessores() }}</div>
                    </div>
                </div>
            </section>


            <section class="card">
                <!-- Toggle e controles -->
                <div class="controls-header">
                    <div class="toggle-container">
                        <button class="toggle-btn" [class.active]="viewMode() === 'alunos'"
                            (click)="toggleView('alunos')">
                            üë®‚Äçüéì Alunos
                        </button>
                        <button class="toggle-btn" [class.active]="viewMode() === 'professores'"
                            (click)="toggleView('professores')">
                            üë®‚Äçüè´ Professores
                        </button>
                    </div>

                    <div class="items-per-page">
                        <label for="itemsPerPage">Itens por p√°gina:</label>
                        <select id="itemsPerPage" [(ngModel)]="itemsPerPage" (change)="onItemsPerPageChange()"
                            class="form-select">
                            <option *ngFor="let option of itemsPerPageOptions" [value]="option">
                                {{ option }}
                            </option>
                        </select>
                    </div>

                    <div style="display:flex; gap:12px; align-items:center">
                        <div class="search-container">
                            <input type="text" [(ngModel)]="searchQuery" (input)="onSearch()"
                                placeholder="üîç Buscar aluno por nome, matr√≠cula ou CPF..." class="search-input">
                        </div>
                    </div>

                    <button class="novo-cadastro"
                        [routerLink]="viewMode() === 'alunos' ? '/cadastro-aluno' : '/cadastro-professor'">
                        + Novo {{ viewMode() === 'alunos' ? 'Aluno' : 'Professor' }}
                    </button>
                </div>

                <h3 style="margin-top:16px">Total: {{ currentTotal }}</h3>

                <!-- Mensagens de sucesso/erro -->
                <div *ngIf="successMessage()" class="alert alert-success">
                    {{ successMessage() }}
                </div>
                <div *ngIf="errorMessage()" class="alert alert-danger">
                    {{ errorMessage() }}
                </div>

                <!-- Loading -->
                <div *ngIf="isLoading()" class="loading-container">
                    <div class="spinner"></div>
                    <p>Carregando {{ viewMode() === 'alunos' ? 'alunos' : 'professores' }}...</p>
                </div>

                <!-- Tabelas -->
                <div *ngIf="!isLoading()">
                    <!-- Tabela de Alunos -->
                    <div *ngIf="viewMode() === 'alunos'">
                        <table *ngIf="filteredAlunos.length > 0">
                            <thead>
                                <tr>
                                    <th>Matr√≠cula</th>
                                    <th>Nome</th>
                                    <th>CPF</th>
                                    <th>Data Nasc.</th>
                                    <th>Idade</th>
                                    <th>Nome Respons√°vel</th>
                                    <th>Telefone</th>
                                    <th>Endere√ßo</th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let aluno of filteredAlunos">
                                    <td><strong>{{ aluno.matricula }}</strong></td>
                                    <td>{{ aluno.nome }}</td>
                                    <td>{{ formatCpfMasked(aluno.cpf) }}</td>
                                    <td>{{ aluno.data_nascimento | date: 'dd/MM/yyyy' }}</td>
                                    <td>{{ calcularIdade(aluno.data_nascimento) }} anos</td>
                                    <td>{{ aluno.nome_responsavel }}</td>
                                    <td>{{ formatTelefone(aluno.telefone) }}</td>
                                    <td>{{ aluno.endereco }}</td>
                                    <td class="actions">
                                        <button class="btn-edit-small" (click)="openEditAlunoDialog(aluno)"
                                            title="Editar aluno">
                                            <mat-icon>edit</mat-icon>
                                        </button>
                                        <button class="btn-danger-small" (click)="deleteAluno(aluno)"
                                            title="Excluir aluno">
                                            <mat-icon>delete</mat-icon>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Tabela de Professores -->
                    <div *ngIf="viewMode() === 'professores'">
                        <table *ngIf="filteredProfessores.length > 0">
                            <thead>
                                <tr>
                                    <th>Nome</th>
                                    <th>CPF</th>
                                    <th>E-mail</th>
                                    <th>Telefone</th>
                                    <th>Endere√ßo</th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let professor of filteredProfessores">
                                    <td><strong>{{ professor.nome }}</strong></td>
                                    <td>{{ formatCpfMasked(professor.cpf) }}</td>
                                    <td>{{ professor.email }}</td>
                                    <td>{{ formatTelefone(professor.telefone) }}</td>
                                    <td>{{ professor.endereco }}</td>
                                    <td class="actions">
                                        <button class="btn-edit-small" (click)="openEditProfessorDialog(professor)"
                                            title="Editar professor">
                                            <mat-icon>edit</mat-icon>
                                        </button>
                                        <button class="btn-danger-small" (click)="deleteProfessor(professor)"
                                            title="Excluir professor">
                                            <mat-icon>delete</mat-icon>
                                        </button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Mensagem quando n√£o h√° resultados -->
                    <div *ngIf="viewMode() === 'alunos' && filteredAlunos.length === 0" class="no-results">
                        <p>Nenhum aluno encontrado.</p>
                        <button class="btn-primary" routerLink="/cadastro-aluno">Cadastrar Primeiro Aluno</button>
                    </div>

                    <div *ngIf="viewMode() === 'professores' && filteredProfessores.length === 0" class="no-results">
                        <p>Nenhum professor encontrado.</p>
                        <button class="btn-primary" routerLink="/cadastro-professor">Cadastrar Primeiro
                            Professor</button>
                    </div>

                    <!-- Pagina√ß√£o -->
                    <div *ngIf="currentTotal > 0 && totalPages() > 1" class="pagination">
                        <button class="pagination-btn" (click)="previousPage()" [disabled]="currentPage() === 1">
                            ‚Üê Anterior
                        </button>

                        <div class="pagination-pages">
                            <button *ngFor="let page of pageNumbers" class="pagination-page"
                                [class.active]="page === currentPage()" (click)="goToPage(page)">
                                {{ page }}
                            </button>
                        </div>

                        <button class="pagination-btn" (click)="nextPage()" [disabled]="currentPage() === totalPages()">
                            Pr√≥xima ‚Üí
                        </button>
                    </div>

                    <div class="pagination-info" *ngIf="currentTotal > 0">
                        Mostrando {{ (currentPage() - 1) * itemsPerPage() + 1 }} -
                        {{ Math.min(currentPage() * itemsPerPage(), currentTotal) }}
                        de {{ currentTotal }} {{ viewMode() === 'alunos' ? 'alunos' : 'professores' }}
                    </div>
                </div>
            </section>

        </main>
    </div>
</body>
